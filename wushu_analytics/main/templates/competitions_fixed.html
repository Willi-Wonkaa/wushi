{% extends 'base.html' %}

{% block title %}–°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è - Wushu Analytics{% endblock %}

{% block page_title %}–°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è{% endblock %}

{% block content %}
{% if not selected %}
<!-- Competition Selection -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ</h5>
            </div>
            <div class="card-body">
                {% if competitions %}
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–î–∞—Ç—ã</th>
                                    <th>–ú–µ—Å—Ç–æ</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for comp in competitions %}
                                <tr>
                                    <td class="fw-bold">{{ comp.name }}</td>
                                    <td>{{ comp.start_date|date:"d.m.Y" }} - {{ comp.end_date|date:"d.m.Y" }}</td>
                                    <td><i class="bi bi-geo-alt"></i> {{ comp.sity }}</td>
                                    <td>
                                        {% if comp.start_date > today %}
                                            <span class="badge-custom badge-warning">—Å–∫–æ—Ä–æ</span>
                                        {% elif comp.end_date < today %}
                                            <span class="badge-custom badge-secondary">–ø—Ä–æ—à–ª–∏</span>
                                        {% else %}
                                            <span class="badge-custom badge-success">–∏–¥–µ—Ç</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="?competition_id={{ comp.id }}" class="btn btn-sm btn-primary">
                                            <i class="bi bi-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-calendar-x display-4 text-muted"></i>
                        <p class="text-muted mt-2">–°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% else %}
<!-- Competition Detail -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <h5 class="card-title mb-0">{{ competition.name }}</h5>
                    <small class="text-muted">{{ competition.sity }} | {{ competition.start_date|date:"d.m.Y" }} - {{ competition.end_date|date:"d.m.Y" }}</small>
                </div>
                <a href="?competition_id=" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> –ö —Å–ø–∏—Å–∫—É
                </a>
            </div>
            <div class="card-body">
                {% if detail_data %}
                    <!-- Regulation Section -->
                    {% if detail_data.regulation %}
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">üìã –†–µ–≥–ª–∞–º–µ–Ω—Ç —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è</h6>
                                </div>
                                <div class="card-body">
                                    {{ detail_data.regulation|linebreaks }}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Categories by Mats -->
                    {% if detail_data.categories %}
                        {% if competition_status == 'active' %}
                            <!-- Current Categories -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card border-success">
                                        <div class="card-header bg-success text-white">
                                            <h6 class="mb-0">üî• –ò–¥—É—â–∏–µ —Å–µ–π—á–∞—Å</h6>
                                        </div>
                                        <div class="card-body">
                                            {% if has_current_categories %}
                                                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
                                                <div class="categories-container">
                                                    {% for category in detail_data.categories %}
                                                        {% if category.status == 'current' %}
                                                            <div class="card mb-3 category-card" data-carpet="" data-status="{{ category.status }}">
                                                                <div class="card-header d-flex justify-content-between align-items-center">
                                                                    <div>
                                                                        <h6 class="mb-0">{{ category.name }}</h6>
                                                                        <small class="text-muted">{{ category.time_range }}</small>
                                                                    </div>
                                                                    <div>
                                                                        <span class="badge bg-success">–∏–¥–µ—Ç</span>
                                                                    </div>
                                                                </div>
                                                                <div class="card-body">
                                                                    {% if category.participants %}
                                                                        <div class="table-responsive mt-2">
                                                                            <table class="table table-sm">
                                                                                <thead>
                                                                                    <tr>
                                                                                        <th>#</th>
                                                                                        <th>–ò–º—è</th>
                                                                                        <th>–†–µ–≥–∏–æ–Ω</th>
                                                                                        <th>–í—Ä–µ–º—è</th>
                                                                                        <th>–û—á–∫–∏</th>
                                                                                    </tr>
                                                                                </thead>
                                                                                <tbody>
                                                                                    {% for participant in category.participants %}
                                                                                    <tr>
                                                                                        <td>{{ participant.place }}</td>
                                                                                        <td>{{ participant.name }}</td>
                                                                                        <td>{{ participant.region }}</td>
                                                                                        <td>{{ participant.start_time }}</td>
                                                                                        <td>{{ participant.score }}</td>
                                                                                    </tr>
                                                                                    {% endfor %}
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                    {% endif %}
                                                                </div>
                                                            </div>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted">–ù–µ—Ç –∏–¥—É—â–∏—Ö —Å–µ–π—á–∞—Å –∫–∞—Ç–µ–≥–æ—Ä–∏–π</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                            
                            <!-- –§–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ–≥–¥–∞) -->
                            {% if detail_data.categories %}
                            <div class="row mb-3">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h6 class="mb-0">üîç –§–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row mb-3">
                                                <div class="col-md-3">
                                                    <label for="carpetFilter" class="form-label">–ö–æ–≤–µ—Ä</label>
                                                    <select class="form-select form-select-sm" id="carpetFilter">
                                                        <option value="">–í—Å–µ –∫–æ–≤—Ä—ã</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label for="statusFilter" class="form-label">–°—Ç–∞—Ç—É—Å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
                                                    <select class="form-select form-select-sm" id="statusFilter">
                                                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                                                        <option value="current">–ò–¥–µ—Ç</option>
                                                        <option value="past">–ó–∞–∫–æ–Ω—á–∏–ª–∞—Å—å</option>
                                                        <option value="next">–°–ª–µ–¥—É—é—â–∞—è</option>
                                                        <option value="future">–ï—â–µ –Ω–µ –Ω–∞—á–∞–ª–∞—Å—å</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label for="categoryFilter" class="form-label">–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞</label>
                                                    <select class="form-select form-select-sm" id="categoryFilter">
                                                        <option value="">–í—Å–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label for="ageFilter" class="form-label">–í–æ–∑—Ä–∞—Å—Ç–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                                                    <select class="form-select form-select-sm" id="ageFilter">
                                                        <option value="">–í—Å–µ –≤–æ–∑—Ä–∞—Å—Ç—ã</option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="sortBy" class="form-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
                                                    <select class="form-select form-select-sm" id="sortBy">
                                                        <option value="carpet-asc">–ö–æ–≤–µ—Ä (–ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é)</option>
                                                        <option value="carpet-desc">–ö–æ–≤–µ—Ä (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)</option>
                                                        <option value="category">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                                                        <option value="time">–ü–æ –≤—Ä–µ–º–µ–Ω–∏</option>
                                                        <option value="participants">–ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6 d-flex align-items-end">
                                                    <button class="btn btn-sm btn-outline-primary me-2" onclick="applyFilters()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                                                    <button class="btn btn-sm btn-outline-secondary" onclick="resetFilters()">–°–±—Ä–æ—Å–∏—Ç—å</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="filtered-categories-container">
                                        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
                                    </div>
                                </div>
                            </div>

                        <!-- Next Categories -->
                        {% if has_next_categories %}
                            <div class="row">
                                <div class="col-12">
                                    <h6 class="mb-3">‚è≠Ô∏è –°–ª–µ–¥—É—é—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h6>

                                    {% for category in detail_data.categories %}
                                        {% if category.status == 'next' %}
                                            <div class="card mb-3">
                                                <div class="card-header d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <h6 class="mb-0">{{ category.name }}</h6>
                                                        <small class="text-muted">{{ category.time_range }}</small>
                                                    </div>
                                                    <div>
                                                        <span class="badge bg-info">—Å–ª–µ–¥—É—é—â–∞—è</span>
                                                    </div>
                                                </div>
                                                <div class="card-body">
                                                    {% if category.participants %}
                                                        <div class="table-responsive">
                                                            <table class="table table-sm">
                                                                <thead>
                                                                    <tr>
                                                                        <th>#</th>
                                                                        <th>–ò–º—è</th>
                                                                        <th>–†–µ–≥–∏–æ–Ω</th>
                                                                        <th>–í—Ä–µ–º—è</th>
                                                                        <th>–û—Ü–µ–Ω–∫–∞</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    {% for participant in category.participants %}
                                                                        <tr>
                                                                            <td>{{ participant.place }}</td>
                                                                            <td>{{ participant.name }}</td>
                                                                            <td>{{ participant.region }}</td>
                                                                            <td>{{ participant.start_time }}</td>
                                                                            <td>{{ participant.score }}</td>
                                                                        </tr>
                                                                    {% endfor %}
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    {% else %}
                                                        <p class="text-muted">–ù–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</p>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}

                        <!-- All Categories by Mats -->
                        <div class="row">
                            <div class="col-12">
                                <h6 class="mb-3">üèüÔ∏è –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ –∫–æ–≤—Ä–∞–º</h6>
                                
                                {% for category in detail_data.categories %}
                                    <div class="card mb-3">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <div>
                                                <h6 class="mb-0">{{ category.name }}</h6>
                                                <small class="text-muted">{{ category.time_range }}</small>
                                            </div>
                                            <div>
                                                {% if category.status == 'current' %}
                                                    <span class="badge bg-success">–∏–¥–µ—Ç</span>
                                                {% elif category.status == 'past' %}
                                                    <span class="badge bg-secondary">–∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å</span>
                                                {% elif category.status == 'next' %}
                                                    <span class="badge bg-info">—Å–ª–µ–¥—É—é—â–∞—è</span>
                                                {% else %}
                                                    <span class="badge bg-warning">–µ—â–µ –Ω–µ –Ω–∞—á–∞–ª–∞—Å—å</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            {% if category.participants %}
                                                <div class="table-responsive">
                                                    <table class="table table-sm">
                                                        <thead>
                                                            <tr>
                                                                <th>#</th>
                                                                <th>–ò–º—è</th>
                                                                <th>–†–µ–≥–∏–æ–Ω</th>
                                                                <th>–í—Ä–µ–º—è</th>
                                                                <th>–û—á–∫–∏</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for participant in category.participants %}
                                                            <tr>
                                                                <td>{{ participant.place }}</td>
                                                                <td>{{ participant.name }}</td>
                                                                <td>{{ participant.region }}</td>
                                                                <td>{{ participant.start_time }}</td>
                                                                <td>{{ participant.score }}</td>
                                                            </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            {% else %}
                                                <p class="text-muted">–£—á–∞—Å—Ç–Ω–∏–∫–∏ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="bi bi-info-circle display-4 text-muted"></i>
                            <p class="text-muted mt-2">–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</p>
                        </div>
                    {% endif %}
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-hourglass-split display-4 text-muted"></i>
                        <p class="text-muted mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–∏...</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
    window.allCategories = {{ categories_json|safe }};
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ –ø–æ–ª—è
    window.allCategories = window.allCategories.map(cat => ({
        ...cat,
        carpetNumber: extractCarpetNumber(cat.name),
        discipline: extractDiscipline(cat.name),
        ageCategory: extractAgeCategory(cat.name)
    }));
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
    initializeFilters();
});

function initializeFilters() {
    // –ü–æ–ª—É—á–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
    const carpets = [...new Set(window.allCategories.map(cat => cat.carpetNumber).filter(n => n))].sort();
    const disciplines = [...new Set(window.allCategories.map(cat => cat.discipline).filter(d => d && d !== '–î—Ä—É–≥–æ–µ'))].sort();
    const ages = [...new Set(window.allCategories.map(cat => cat.ageCategory).filter(a => a && a !== '–õ—é–±–æ–π'))].sort();
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –∏–¥—É—â–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    const carpetFilter = document.getElementById('carpetFilter');
    const categoryFilter = document.getElementById('categoryFilter');
    const ageFilter = document.getElementById('ageFilter');
    
    if (carpetFilter) {
        carpets.forEach(carpet => {
            carpetFilter.innerHTML += `<option value="${carpet}">–ö–æ–≤–µ—Ä ${carpet}</option>`;
        });
    }
    
    if (categoryFilter) {
        disciplines.forEach(discipline => {
            categoryFilter.innerHTML += `<option value="${discipline}">${discipline}</option>`;
        });
    }
    
    if (ageFilter) {
        ages.forEach(age => {
            ageFilter.innerHTML += `<option value="${age}">${age} –ª–µ—Ç</option>`;
        });
    }
}

function extractCarpetNumber(name) {
    const patterns = [/–ö\s*(\d+)/i, /–ö(\d+)/i, /Carpet\s*(\d+)/i, /C(\d+)/i];
    for (let pattern of patterns) {
        const match = name.match(pattern);
        if (match) return parseInt(match[1]);
    }
    return null;
}

function extractDiscipline(name) {
    const disciplines = ['–¢–∞–æ–ª—É', '–°–∞–Ω–¥–∞', '–î—É—ç–ª—è–Ω', '–¶–∑—é–∞–Ω—å—à—É'];
    for (let discipline of disciplines) {
        if (name.includes(discipline)) return discipline;
    }
    return '–î—Ä—É–≥–æ–µ';
}

function extractAgeCategory(name) {
    const match = name.match(/(\d+\s*[-‚Äì]\s*\d+|\d+\+)/);
    return match ? match[1] : '–õ—é–±–æ–π';
}

function applyFilters() {
    const carpetFilter = document.getElementById('carpetFilter').value;
    const statusFilter = document.getElementById('statusFilter').value;
    const categoryFilter = document.getElementById('categoryFilter').value;
    const ageFilter = document.getElementById('ageFilter').value;
    const sortBy = document.getElementById('sortBy').value;
    
    let filtered = window.allCategories.filter(cat => {
        if (carpetFilter && cat.carpetNumber != carpetFilter) return false;
        if (statusFilter && cat.status !== statusFilter) return false;
        if (categoryFilter && cat.discipline !== categoryFilter) return false;
        if (ageFilter && cat.ageCategory !== ageFilter) return false;
        return true;
    });
    
    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
    filtered.sort((a, b) => {
        switch(sortBy) {
            case 'carpet-asc':
                return (a.carpetNumber || 999) - (b.carpetNumber || 999);
            case 'carpet-desc':
                return (b.carpetNumber || 0) - (a.carpetNumber || 0);
            case 'category':
                return a.name.localeCompare(b.name);
            case 'time':
                return a.timeRange.localeCompare(b.timeRange);
            case 'participants':
                return (b.participants ? b.participants.length : 0) - (a.participants ? a.participants.length : 0);
            default:
                return 0;
        }
    });
    
    displayFilteredCategories(filtered);
}

function resetFilters() {
    document.getElementById('carpetFilter').value = '';
    document.getElementById('statusFilter').value = '';
    document.getElementById('categoryFilter').value = '';
    document.getElementById('ageFilter').value = '';
    document.getElementById('sortBy').value = 'carpet-asc';
    applyFilters();
}

function displayFilteredCategories(categories) {
    const container = document.querySelector('.filtered-categories-container');
    if (!container) return;
    
    if (categories.length === 0) {
        container.innerHTML = '<p class="text-muted">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º</p>';
        return;
    }
    
    container.innerHTML = categories.map((cat, index) => `
        <div class="card mb-3 category-card" data-carpet="${cat.carpetNumber}" data-status="${cat.status}" data-discipline="${cat.discipline}" data-age="${cat.ageCategory}">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="mb-0">${cat.name}</h6>
                    <small class="text-muted">${cat.timeRange}</small>
                </div>
                <div>
                    ${getStatusBadge(cat.status)}
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>–ò–º—è</th>
                                <th>–†–µ–≥–∏–æ–Ω</th>
                                <th>–í—Ä–µ–º—è</th>
                                <th>–û—Ü–µ–Ω–∫–∞</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${getParticipantsHTML(cat.participants)}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    `).join('');
}

function getStatusBadge(status) {
    const badges = {
        'current': '<span class="badge bg-success">–∏–¥–µ—Ç</span>',
        'past': '<span class="badge bg-secondary">–∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å</span>',
        'next': '<span class="badge bg-info">—Å–ª–µ–¥—É—é—â–∞—è</span>',
        'future': '<span class="badge bg-warning">–µ—â–µ –Ω–µ –Ω–∞—á–∞–ª–∞—Å—å</span>'
    };
    return badges[status] || '';
}

function getParticipantsHTML(participants) {
    if (!participants || participants.length === 0) {
        return '<tr><td colspan="5" class="text-center">–ù–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</td></tr>';
    }
    
    return participants.map(p => `
        <tr>
            <td>${p.place || ''}</td>
            <td>${p.name || ''}</td>
            <td>${p.region || ''}</td>
            <td>${p.start_time || ''}</td>
            <td>${p.score || ''}</td>
        </tr>
    `).join('');
}
</script>
{% endblock %}
