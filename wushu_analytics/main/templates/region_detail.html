{% extends 'base.html' %}

{% block title %}{{ region_name }} - Wushu Analytics{% endblock %}

{% block page_title %}{{ region_name }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Back button -->
    <div class="mb-4">
        <a href="{% url 'regions' %}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> –ö —Å–ø–∏—Å–∫—É —Ä–µ–≥–∏–æ–Ω–æ–≤
        </a>
    </div>

    <!-- Region Header Card -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-4">
                    <h2 class="mb-2"><i class="bi bi-geo-alt"></i> {{ region_name }}</h2>
                    <p class="text-muted mb-0">–ö–æ–º–∞–Ω–¥–∞ —Ä–µ–≥–∏–æ–Ω–∞</p>
                </div>
                <div class="col-md-8">
                    <div class="row text-center">
                        <div class="col-2">
                            <div class="stat-mini">
                                <div class="stat-value-mini">{{ participants_count }}</div>
                                <div class="stat-label-mini">–°–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤</div>
                            </div>
                        </div>
                        <div class="col-2">
                            <div class="stat-mini">
                                <div class="stat-value-mini">{{ competitions_count }}</div>
                                <div class="stat-label-mini">–°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π</div>
                            </div>
                        </div>
                        <div class="col-2">
                            <div class="stat-mini">
                                <div class="stat-value-mini" style="color: #ffd700;">{{ total_gold }}</div>
                                <div class="stat-label-mini">ü•á –ó–æ–ª–æ—Ç–æ</div>
                            </div>
                        </div>
                        <div class="col-2">
                            <div class="stat-mini">
                                <div class="stat-value-mini" style="color: #c0c0c0;">{{ total_silver }}</div>
                                <div class="stat-label-mini">ü•à –°–µ—Ä–µ–±—Ä–æ</div>
                            </div>
                        </div>
                        <div class="col-2">
                            <div class="stat-mini">
                                <div class="stat-value-mini" style="color: #cd7f32;">{{ total_bronze }}</div>
                                <div class="stat-label-mini">ü•â –ë—Ä–æ–Ω–∑–∞</div>
                            </div>
                        </div>
                        <div class="col-2">
                            <div class="stat-mini">
                                <div class="stat-value-mini" style="color: #0088cc;">{{ overall_avg }}</div>
                                <div class="stat-label-mini">–°—Ä. –±–∞–ª–ª (2–≥)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Participants Table -->
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0"><i class="bi bi-people"></i> –°–ø–æ—Ä—Ç—Å–º–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã ({{ participants_count }})</h6>
        </div>
        <div class="card-body">
            {% if participants %}
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>–§–ò–û</th>
                            <th>–°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π</th>
                            <th>–ú–µ–¥–∞–ª–∏</th>
                            <th>–°—Ä. –±–∞–ª–ª (2 –≥–æ–¥–∞)</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for p in participants %}
                        <tr>
                            <td>
                                <div class="fw-bold">{{ p.participant.name }}</div>
                            </td>
                            <td>
                                <span class="badge bg-info">{{ p.competitions_count }}</span>
                            </td>
                            <td>
                                {% if p.gold > 0 %}
                                    <span class="badge bg-warning text-dark">ü•á {{ p.gold }}</span>
                                {% endif %}
                                {% if p.silver > 0 %}
                                    <span class="badge bg-secondary">ü•à {{ p.silver }}</span>
                                {% endif %}
                                {% if p.bronze > 0 %}
                                    <span class="badge bg-danger">ü•â {{ p.bronze }}</span>
                                {% endif %}
                                {% if p.gold == 0 and p.silver == 0 and p.bronze == 0 %}
                                    <span class="text-muted">‚Äî</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if p.avg_score > 0 %}
                                    <span class="badge bg-success">{{ p.avg_score }}</span>
                                {% else %}
                                    <span class="text-muted">‚Äî</span>
                                {% endif %}
                            </td>
                            <td>
                                <a href="{% url 'athlete_detail' p.participant.id %}" class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-person"></i> –ü—Ä–æ—Ñ–∏–ª—å
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-4">
                <i class="bi bi-people display-4 text-muted"></i>
                <p class="text-muted mt-2">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞—Ö</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Competitions History -->
    <div class="card mb-4">
        <div class="card-header">
            <h6 class="mb-0"><i class="bi bi-trophy"></i> –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π –∫–æ–º–∞–Ω–¥—ã ({{ competitions_count }})</h6>
        </div>
        <div class="card-body">
            {% if competitions_data %}
            <div class="table-responsive mb-4">
                <table class="table">
                    <thead>
                        <tr>
                            <th>–°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ</th>
                            <th>–ì–æ—Ä–æ–¥</th>
                            <th>–î–∞—Ç—ã</th>
                            <th>–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (–≤—Å–µ–≥–æ)</th>
                            <th>–ö–æ–º–∞–Ω–¥–∞</th>
                            <th>–í—ã—Å—Ç—É–ø–ª–µ–Ω–∏–π</th>
                            <th>–ú–µ–¥–∞–ª–∏</th>
                            <th>–°—Ä. –±–∞–ª–ª</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for comp in competitions_data %}
                        <tr>
                            <td>
                                <a href="{% url 'competitions' %}?competition_id={{ comp.competition.id }}" class="text-primary">
                                    {{ comp.competition.name }}
                                </a>
                            </td>
                            <td><i class="bi bi-geo-alt text-muted"></i> {{ comp.competition.sity }}</td>
                            <td>{{ comp.competition.start_date|date:"d.m.Y" }} - {{ comp.competition.end_date|date:"d.m.Y" }}</td>
                            <td><span class="badge bg-secondary">{{ comp.total_participants }}</span></td>
                            <td><span class="badge bg-info">{{ comp.team_participants }}</span></td>
                            <td><span class="badge bg-primary">{{ comp.team_performances }}</span></td>
                            <td>
                                {% if comp.gold > 0 %}
                                    <span class="badge bg-warning text-dark">ü•á {{ comp.gold }}</span>
                                {% endif %}
                                {% if comp.silver > 0 %}
                                    <span class="badge bg-secondary">ü•à {{ comp.silver }}</span>
                                {% endif %}
                                {% if comp.bronze > 0 %}
                                    <span class="badge bg-danger">ü•â {{ comp.bronze }}</span>
                                {% endif %}
                                {% if comp.gold == 0 and comp.silver == 0 and comp.bronze == 0 %}
                                    <span class="text-muted">‚Äî</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if comp.team_avg > 0 %}
                                    <span class="badge bg-success">{{ comp.team_avg }}</span>
                                {% else %}
                                    <span class="text-muted">‚Äî</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-4">
                <i class="bi bi-calendar-x display-4 text-muted"></i>
                <p class="text-muted mt-2">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è—Ö</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Competition Details Blocks -->
    {% for comp in competitions_data %}
    <div class="card mb-4 competition-block">
        <div class="card-header bg-primary text-white">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h5 class="mb-0">{{ comp.competition.name }}</h5>
                    <small>
                        <i class="bi bi-geo-alt"></i> {{ comp.competition.sity }} | 
                        <i class="bi bi-calendar"></i> {{ comp.competition.start_date|date:"d.m.Y" }} - {{ comp.competition.end_date|date:"d.m.Y" }}
                    </small>
                </div>
                <a href="{% url 'competitions' %}?competition_id={{ comp.competition.id }}" class="btn btn-light btn-sm">
                    <i class="bi bi-box-arrow-up-right"></i> –ü–µ—Ä–µ–π—Ç–∏
                </a>
            </div>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-2 text-center">
                    <div class="stat-mini">
                        <div class="stat-value-mini">{{ comp.total_participants }}</div>
                        <div class="stat-label-mini">–í—Å–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
                    </div>
                </div>
                <div class="col-md-2 text-center">
                    <div class="stat-mini">
                        <div class="stat-value-mini">{{ comp.team_participants }}</div>
                        <div class="stat-label-mini">–ù–∞—à–∏—Ö —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤</div>
                    </div>
                </div>
                <div class="col-md-2 text-center">
                    <div class="stat-mini">
                        <div class="stat-value-mini">{{ comp.team_performances }}</div>
                        <div class="stat-label-mini">–í—ã—Å—Ç—É–ø–ª–µ–Ω–∏–π</div>
                    </div>
                </div>
                <div class="col-md-2 text-center">
                    <div class="stat-mini">
                        <div class="stat-value-mini" style="color: #ffd700;">{{ comp.gold }}</div>
                        <div class="stat-label-mini">ü•á –ó–æ–ª–æ—Ç–æ</div>
                    </div>
                </div>
                <div class="col-md-2 text-center">
                    <div class="stat-mini">
                        <div class="stat-value-mini" style="color: #c0c0c0;">{{ comp.silver }}</div>
                        <div class="stat-label-mini">ü•à –°–µ—Ä–µ–±—Ä–æ</div>
                    </div>
                </div>
                <div class="col-md-2 text-center">
                    <div class="stat-mini">
                        <div class="stat-value-mini" style="color: #cd7f32;">{{ comp.bronze }}</div>
                        <div class="stat-label-mini">ü•â –ë—Ä–æ–Ω–∑–∞</div>
                    </div>
                </div>
            </div>
            
            {% if comp.team_avg > 0 %}
            <div class="alert alert-info">
                <i class="bi bi-graph-up"></i> –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –∫–æ–º–∞–Ω–¥—ã –Ω–∞ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–∏: <strong>{{ comp.team_avg }}</strong>
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

<style>
.stat-mini {
    padding: 0.5rem;
}
.stat-value-mini {
    font-size: 1.5rem;
    font-weight: 700;
}
.stat-label-mini {
    font-size: 0.75rem;
    color: var(--text-secondary);
}
.competition-block .card-header.bg-primary {
    background: var(--gradient-primary) !important;
}
</style>
{% endblock %}
