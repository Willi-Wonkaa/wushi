{% extends 'base.html' %}

{% block title %}–†–µ–≥–∏–æ–Ω—ã - Wushu Analytics{% endblock %}

{% block page_title %}–†–µ–≥–∏–æ–Ω—ã / –ö–æ–º–∞–Ω–¥—ã{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Statistics Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="bi bi-geo-alt"></i>
            </div>
            <div class="stat-value">{{ total_regions }}</div>
            <div class="stat-label">–í—Å–µ–≥–æ —Ä–µ–≥–∏–æ–Ω–æ–≤</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);">
                <i class="bi bi-people"></i>
            </div>
            <div class="stat-value">{{ total_participants }}</div>
            <div class="stat-label">–í—Å–µ–≥–æ —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤</div>
        </div>
    </div>

    <!-- Search Section -->
    <div class="card mb-4">
        <div class="card-header">
            <h6 class="mb-0"><i class="bi bi-search"></i> –ü–æ–∏—Å–∫ –∫–æ–º–∞–Ω–¥—ã</h6>
        </div>
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-10">
                    <input type="text" class="form-control" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–∞...">
                </div>
                <div class="col-md-2">
                    <button class="btn btn-primary w-100" onclick="filterRegions()">
                        <i class="bi bi-funnel"></i> –ù–∞–π—Ç–∏
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Regions Table -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0"><i class="bi bi-table"></i> –°–ø–∏—Å–æ–∫ —Ä–µ–≥–∏–æ–Ω–æ–≤ / –∫–æ–º–∞–Ω–¥</h6>
            <span class="badge bg-primary">{{ regions|length }} —Ä–µ–≥–∏–æ–Ω–æ–≤</span>
        </div>
        <div class="card-body">
            {% if regions %}
                <div class="table-responsive">
                    <table class="table" id="regionsTable">
                        <thead>
                            <tr>
                                <th>–†–µ–≥–∏–æ–Ω</th>
                                <th>–£—á–∞—Å—Ç–Ω–∏–∫–∏</th>
                                <th>–°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è</th>
                                <th>–ú–µ–¥–∞–ª–∏</th>
                                <th>–°—Ä. –±–∞–ª–ª (2 –≥–æ–¥–∞)</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for region in regions %}
                            <tr class="region-row" data-name="{{ region.name|lower }}">
                                <td>
                                    <div class="fw-bold">{{ region.name }}</div>
                                </td>
                                <td>
                                    <span class="badge bg-info">{{ region.participants_count }}</span>
                                </td>
                                <td>
                                    <span class="badge bg-secondary">{{ region.competitions_count }}</span>
                                </td>
                                <td>
                                    <span class="badge bg-warning text-dark">ü•á {{ region.gold_count }}</span>
                                    <span class="badge bg-secondary">ü•à {{ region.silver_count }}</span>
                                    <span class="badge bg-danger">ü•â {{ region.bronze_count }}</span>
                                </td>
                                <td>
                                    {% if region.avg_score > 0 %}
                                        <div class="d-flex align-items-center">
                                            <span class="me-2">{{ region.avg_score }}</span>
                                            <div class="progress" style="height: 6px; width: 60px;">
                                                <div class="progress-bar bg-success" style="width: {% widthratio region.avg_score 10 100 %}%"></div>
                                            </div>
                                        </div>
                                    {% else %}
                                        <span class="text-muted">‚Äî</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{% url 'region_detail' region.name %}" class="btn btn-sm btn-primary">
                                        <i class="bi bi-bar-chart"></i> –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-geo-alt display-1 text-muted"></i>
                    <h5 class="mt-3 text-muted">–†–µ–≥–∏–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h5>
                    <p class="text-muted">–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–∞—Ä—Å–µ—Ä –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function filterRegions() {
    const searchValue = document.getElementById('searchInput').value.toLowerCase();
    const rows = document.querySelectorAll('.region-row');
    
    rows.forEach(row => {
        const name = row.dataset.name;
        row.style.display = name.includes(searchValue) ? '' : 'none';
    });
}

document.getElementById('searchInput').addEventListener('keyup', filterRegions);
</script>
{% endblock %}
